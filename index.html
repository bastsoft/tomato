<!doctype html>
<html>
<head>
    <title>tomato timer</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=400">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192x192.png"/>
    <link href="tomato.css" rel="stylesheet" media="all"/>
    <link href="main.css" rel="stylesheet" media="all"/>
    <script src="tomato.js"></script>
</head>

<body>
<div id="tomato"></div>
<div>
    <button onclick="set25min()">25 минут</button>
    <button onclick="set5min()">5 минут</button>
    <button onclick="set15min()">15 минут</button>
</div>
<script>

    (function () {
        var isLocalhost = !!(window.location.hostname === 'localhost' ||
        window.location.hostname === '[::1]' ||
        window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));

        if (window.location.protocol !== "https:" && !isLocalhost) {
            window.location.href = "https:" + window.location.href.substring(window.location.protocol.length);
        }

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js', {scope: './'})
                    .then(function (registration) {
                        console.log('success', registration.scope);
                    }).catch(function (err) {
                console.log('failure: ', err);
            });
        }
    }());

    function set25min() {
        tomato.setTimer('00:25', 'red', function () {
            notifyMe('25 минут прошло');
            set5min();
            //tomato.startTimer();
        });
    }

    function set5min() {
        tomato.setTimer('00:05', 'green', function () {
            notifyMe('5 минут прошло');
            set25min();
        });
    }

    function set15min() {
        tomato.setTimer('15:00', 'green', function () {
            notifyMe('15 минут прошло');
            set25min();
        });
    }

    function notifyMe(text) {
        Notification.requestPermission(function (result) {
            if (result === 'granted') {
                navigator.serviceWorker.ready.then(function (registration) {
                    registration.showNotification('ПОМИДОРКА', {
                        tag: "tomato",
                        body: text,
                        icon: "icon-192x192.png",
                        requireInteraction: false
                    });
                });
            }
        });
    }

    document.addEventListener("DOMContentLoaded", function () {
        tomato.init('#tomato');
        set25min();
    });
</script>
</body>
</html>
